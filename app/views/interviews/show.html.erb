<h1>Practice Interview for <%= link_to "#{@interview.applicant.full_name}", user_path(@interview.applicant_id) %></h1>
<h3>Interviewed by <%= @interview.interviewer.full_name %> on <%= @interview.date %> </h3>

<%= render partial: '/challenges/challenge', locals: { challenge: @interview.challenge } %>
<% if current_user == @interview.interviewer || current_user == @interview.applicant %>
  <div class='form-container'>
    <%= form_for @interview do |f| %>
      Whiteboard image:
      <%= f.file_field :image %>
      <%= f.submit 'Upload' %>
    <% end %>
  </div>
<% end %>
<% if current_user == @interview.applicant %>
  <div class='feedback-container'>
    <h2>Your Feedback</h2>
    <%= render partial: '/feedbacks/legend' %>
    <br />
    <% @interview.feedbacks.each do |feedback| %>
      <ul>
        <li>Reviewer: <%= feedback.user.full_name %></li>
        <li>Whiteboard Neatness and Clarity: <%= feedback.board_rating %></li>
        <li>Poise and Presence: <%= feedback.presence_rating %></li>
        <li>Demonstration of Knowledge: <%= feedback.knowledge_rating %></li>
        <li>RIOT Rating: <%= feedback.riot_rating %></li>
        <li>Comments: <%= simple_format(feedback.comments) %></li>
      </ul>
    <% end %>
  </div>
<% else %>
  <% if @interview.has_feedback_from?(current_user)%>
    <% @feedback = @interview.feedbacks.where(user_id: current_user.id) %>
    <%= "FEEDBACK ID: #{@feedback.first.id}"  %>
    <h5>Thank you for your <i>actionable, specific & kind</i> feedback. Click Edit Feedback if you would like to make any changes.</h5>
    <%= button_to "Edit Feedback", edit_interview_feedback_path( @interview, @feedback.first ), method: :get, class: 'button' %>
  <% else %>
    <h1>Give Feedback</h1>
    <div class='form-container'>
      <% if @feedback.errors.any? %>
        <div class='errors'>
          <% @feedback.errors.full_messages.each do |error| %>
            <div>
              <%= error %>
            </div>
          <% end %>
        </div>
        <br />
      <% end %>
      <br />
      <h4>Please rate the candidate's performance using a scale of 1 (needs improvement) to 5 (knocked it out of the park).</h4>
      <%= form_for [@interview, @feedback] do |f| %>
        <%= f.hidden_field :user_id, value: current_user.id %>
        <%= f.hidden_field :interview_id, value: @interview.id %>
        <div class= "form-group">
          <%= f.label "Whiteboard Neatness and Clarity: " %>
          <%= f.select :board_rating, options_for_select([5,4,3,2,1]), { prompt: "-" }, {class: 'form-control'} %>
          <br />
          Was printing neat and readable? Did candidate start at the top left or right of the board? Did candidate leave some space between lines of code or psuedo-code? Did candidate run out of room on the board?
        </div>
        <div class= "form-group">
          <%= f.label "Poise and Presence: " %>
          <%= f.select :presence_rating, options_for_select([5,4,3,2,1]), { prompt: "-" }, {class: 'form-control'}  %>
          <br />
          Did candidate greet the interviewer and shake hands? Was candidate friendly and personable? Did the candidate's body language communicate confidence and ease? Was candidate's volume appropriate?
        </div>
        <div class= "form-group">
          <%= f.label "Demonstration of Knowledge: " %>
          <%= f.select :knowledge_rating, options_for_select([5,4,3,2,1]), { prompt: "-" }, {class: 'form-control'}  %>
          <br />
          Did candidate ask questions that showed thinking process and knowledge of issues to consider? Did the candidate appear to understand the subject matter or show ability to reason while working through a solution?
        </div>
        <div class = "form-group">
          <%= f.label( :riot_rating, "RIOT Rating: ") %>
          <%= f.select :riot_rating, options_for_select([5,4,3,2,1]), { prompt: "-" }, {class: 'form-control'}  %>
          <br />
          <div>R = REPEAT the challenge description</div>
          <div>I = clarify INPUTs</div>
          <div>O = clarify OUTPUTs</div>
          <div>T = consider TESTS (edge cases)</div>
        </div>
        <div class = "form-group">
          <%= f.label "Comments: " %>
          <br />
          <%= f.text_area :comments, size: "80x10", placeholder: "Make sure your feedback is actionable, specific, and kind." %>
        </div>
        <%= f.submit 'Submit Changes' %>
      <% end %>
    </div>
  <% end %>
  <div>
    <%= render partial: '/feedbacks/ask_guidelines' %>
  </div>
<% end %>
<div>
  <%= image_tag @interview.image.url if @interview.image_stored? %>
</div>
