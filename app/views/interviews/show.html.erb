<div class="page-header">
  <div class="pull-left">
    <h2>Practice Interview for <%= link_to "#{@interview.applicant.full_name}", user_path(@interview.applicant_id) %><br />
      <small> Interviewed by <%= @interview.interviewer.full_name %> on <%= @interview.date %> </small></h2>
  </div>
  <div class="clearfix"></div>
</div>

<% if current_user == @interview.interviewer || current_user == @interview.applicant %>
  <% if @interview.was_today? %>
    The access code to join this interview is: <%= @interview.token %>. This code is only valid today (<%= @interview.date %>).
  <% else %>
    This interview is closed to further feedback.
  <% end %>
<% end %>
<%= render partial: '/challenges/challenge', locals: { challenge: @interview.challenge } %>
<% if current_user == @interview.interviewer || current_user == @interview.applicant %>
  <div class='form-container'>
    <%= form_for @interview do |f| %>
      Whiteboard image:
      <%= f.file_field :image %>
      <%= f.submit 'Upload' %>
    <% end %>
  </div>
<% end %>
<% if current_user == @interview.applicant %>
  <div class='feedback-container'>
    <h2>Your Feedback</h2>
    <%= render partial: '/feedbacks/legend' %>
    <br />
    <% @interview.feedbacks.each do |feedback| %>
      <%= render partial: '/feedbacks/show', locals: { feedback: feedback } %>
    <% end %>
  </div>
<% else %>
  <% if @interview.has_feedback_from?(current_user)%>
    <% @feedback = @interview.feedbacks.where(user_id: current_user.id) %>
    <div>
      <%= render partial: '/feedbacks/show', locals: { feedback: @feedback[0] } %>
    </div>
    <%= button_to "Edit Feedback", edit_interview_feedback_path( @interview, @feedback.first ), method: :get, class: 'button' %>
  <% else %>
    <h1>Give Feedback</h1>
    <%= render partial: '/feedbacks/feedback_form' %>
  <% end %>
  <div>
    <%= render partial: '/feedbacks/ask_guidelines' %>
  </div>
<% end %>
<div>
  <%= image_tag @interview.image.url if @interview.image_stored? %>
</div>
